<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>á’áŸ’áœá¾á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á–á‘á¸á€á“áŸ’á›áŸ‚á„</title>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <link
      rel="shortcut icon"
      href="../img/logo/logoFooter.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="../src/output.css" />
    <script
      src="https://kit.fontawesome.com/5ce14b4205.js"
      crossorigin="anonymous"
    ></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#0A4536",
              secondary: "#FF914D",
              danger: "#DC2626",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-background dark:bg-dark_background font-primary">
    <header class="bg-white dark:text-white w-full shadow sticky top-0 z-10">
      <nav
        class="lg:container mx-auto flex items-center justify-between px-4 py-2"
      >
        <a href="/index.html" class="Logo">
          <img
            class="h-auto max-md:w-[100px] md:w-[140px]"
            src="../img/logo/logoHeader.png"
            alt="Logo"
          />
        </a>
        <button
          id="menu-toggle"
          class="lg:hidden text-accent cursor-pointer self-center text-3xl text-gray-850 focus:outline-none"
        >
          <ion-icon name="menu" id="menu-icon"></ion-icon>
        </button>

        <div
          id="nav-links"
          class="hidden bg-white lg:flex lg:items-center lg:gap-8 absolute top-16 left-0 w-full lg:static lg:w-auto p-4 max-sm:p-5 lg:p-0 shadow-lg lg:shadow-none transition-all duration-300 ease-in-out"
        >
          <ul
            class="flex font-primary max-lg:flex-col gap-6 lg:gap-8 text-lg max-lg:items-start font-medium"
          >
            <li>
              <a
                href="/index.html"
                class="text-accent hover:text-secondary transition-colors"
                >á‘áŸ†á–áŸášáŠá¾á˜</a
              >
            </li>
            <li>
              <a
                href="about.html"
                class="text-accent hover:text-secondary transition-colors"
                >á¢áŸ†á–á¸á–á½á€á™á¾á„</a
              >
            </li>
            <li>
              <a
                href="desti.html"
                class="text-accent hover:text-secondary transition-colors"
                >á‚áŸ„á›áŠáŸ…</a
              >
            </li>
          </ul>

          <div
            class="flex font-primary flex-col lg:flex-row gap-4 mt-6 lg:mt-0"
          >
            <button
              id="toggleTheme"
              type="button"
              class="relative inline-flex h-12 w-12 items-center justify-center rounded-full bg-primary dark:bg-blue-950 dark:hover:bg-blue-900 shadow-sm outline-none ring-0 transition-colors duration-500"
              aria-label="Toggle dark mode"
            >
              <!-- SUN (visible in light, hides in dark) -->
              <svg
                class="absolute h-7 w-7 text-white transition-all duration-300 ease-out opacity-100 scale-100 rotate-0 dark:opacity-0 dark:scale-75 dark:rotate-90"
                viewBox="0 -960 960 960"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  d="M440-800v-120h80v120h-80Zm0 760v-120h80v120h-80Zm360-400v-80h120v80H800Zm-760 0v-80h120v80H40Zm708-252-56-56 70-72 58 58-72 70ZM198-140l-58-58 72-70 56 56-70 72Zm564 0-70-72 56-56 72 70-58 58ZM212-692l-72-70 58-58 70 72-56 56Zm268 452q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Z"
                />
              </svg>

              <!-- MOON (hidden in light, shows in dark) -->
              <svg
                class="absolute h-7 w-7 text-white transition-all duration-300 ease-out opacity-0 scale-75 rotate-90 dark:opacity-100 dark:scale-100 dark:rotate-0"
                viewBox="0 -960 960 960"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  d="M484-80q-84 0-157.5-32t-128-86.5Q144-253 112-326.5T80-484q0-146 93-257.5T410-880q-18 99 11 193.5T521-521q71 71 165.5 100T880-410q-26 144-138 237T484-80Z"
                />
              </svg>
            </button>

            <button
              class="group relative w-fit inline-flex h-12 items-center justify-center overflow-hidden rounded-[10px] border border-neutral-200 cursor-pointer bg-primary dark:bg-blue-950 px-[22px] font-medium text-white transition-all active:translate-y-[2px] active:shadow-none"
              href="../html/loginnnn.html"
            >
              <a href="../html/loginnnn.html">á…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡</a>
            </button>

            <button
              id="dropdownDelayButton"
              data-dropdown-toggle="dropdownDelay"
              data-dropdown-delay="500"
              class="border-neutral-200 h-12 w-fit bg-primary text-white cursor-pointer focus:ring-4 focus:outline-none font-medium rounded-lg text-sm px-5 text-center inline-flex items-center dark:bg-blue-950 dark:hover:bg-blue-900"
              type="button"
            >
              á•áŸ’áŸáŸá„áŸ—
              <svg
                class="w-2.5 h-2.5 ms-3"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 10 6"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m1 1 4 4 4-4"
                />
              </svg>
            </button>
            <!-- Dropdown menu -->
            <div
              id="dropdownDelay"
              class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44 dark:bg-blue-950"
            >
              <ul
                class="py-2 rounded-lg text-sm text-white bg-primary dark:bg-blue-950"
                aria-labelledby="dropdownDelayButton"
              >
                <li>
                  <a
                    href="../html/post.html"
                    class="block px-4 py-2 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-600 dark:hover:text-white"
                    >á”á“áŸ’ááŸ‚á˜á‘á¸á€á“áŸ’á›áŸ‚á„</a
                  >
                </li>
                <li>
                  <a
                    href="../html/update.html"
                    class="block px-4 py-2 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-600 dark:hover:text-white"
                    >á’áŸ’áœá¾á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á–á‘á¸á€á“áŸ’á›áŸ‚á„</a
                  >
                </li>
                <li>
                  <a
                    href="../html/delete.html"
                    class="block px-4 py-2 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-600 dark:hover:text-white"
                    >á›á»á”á‘á¸á€á“áŸ’á›áŸ‚á„</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <section class="min-h-screen bg-gradient-to-br p-5 font-sans">
        <div
          class="container mx-auto flex justify-center py-5 gap-4 font-primary"
        >
          <button
            class="group relative w-fit inline-flex h-12 items-center dark:hover:bg-white hover:bg-white hover:text-primary dark:hover:text-dark_background justify-center overflow-hidden rounded-[10px] border border-neutral-200 cursor-pointer bg-primary dark:bg-blue-950 px-[22px] font-medium text-white transition-all active:translate-y-[2px] active:shadow-none"
          >
            <a href="delete.html">á›á»á”á‘á¸á€á“áŸ’á›áŸ‚á„</a>
          </button>
          <button
            class="group relative w-fit inline-flex h-12 items-center justify-center overflow-hidden rounded-[10px] border hover:bg-white hover:text-primary border-neutral-200 cursor-pointer bg-primary dark:bg-blue-950 px-[22px] font-medium text-white transition-all active:translate-y-[2px] active:shadow-none"
          >
            <a href="post.html">á”á“áŸ’ááŸ‚á˜á‘á¸á€á“áŸ’á›áŸ‚á„</a>
          </button>
        </div>
        <div
          class="max-w-4xl font-primary mx-auto bg-white/95 rounded-2xl p-10 shadow-xl backdrop-blur-sm"
        >
          <h1
            class="text-center text-primary text-4xl font-extrabold mb-8 bg-clip-text bg-gradient-to-r from-primary to-green-500"
          >
            á€áŸ‚á”áŸ’ášáŸ‚á‘á¸á€á“áŸ’á›áŸ‚á„
          </h1>

          <!-- Search and Select Place -->
          <div class="mb-8">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">
              áŸáŸ’áœáŸ‚á„ášá€á€á“áŸ’á›áŸ‚á„áŠá¾á˜áŸ’á”á¸á€áŸ‚á”áŸ’ášáŸ‚
            </h2>

            <!-- Search Input -->
            <div class="flex flex-col mb-4">
              <label for="searchInput" class="font-semibold text-gray-700 mb-2"
                >áŸáŸ’áœáŸ‚á„ášá€á‘á¸á€á“áŸ’á›áŸ‚á„</label
              >
              <input
                type="text"
                id="searchInput"
                placeholder="áœá¶á™áˆáŸ’á˜áŸ„áŸ‡á€á“áŸ’á›áŸ‚á„áŠá¾á˜áŸ’á”á¸áŸáŸ’áœáŸ‚á„ášá€..."
                class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
              />
            </div>

            <!-- Places List -->
            <div
              id="placesList"
              class="space-y-2 max-h-64 overflow-y-auto hidden"
            >
              <!-- Places will be loaded here -->
            </div>

            <!-- Load All Places Button -->
            <button
              id="loadPlacesBtn"
              class="w-full bg-primary text-white font-semibold py-3 rounded-xl hover:bg-primary/90 transition-all"
            >
              ğŸ“‹ á”á„áŸ’á á¶á‰á€á“áŸ’á›áŸ‚á„á‘á¶áŸ†á„á¢áŸáŸ‹
            </button>
          </div>

          <!-- Update Form -->
          <form id="updateForm" class="hidden space-y-6">
            <input type="hidden" id="placeUuid" name="placeUuid" />

            <div class="bg-green-50 p-4 rounded-xl mb-6">
              <h3 class="text-lg font-semibold text-green-800 mb-2">
                á€áŸ‚á”áŸ’ášáŸ‚á–áŸááŸŒá˜á¶á“á‘á¸á€á“áŸ’á›áŸ‚á„
              </h3>
              <p class="text-green-700 text-sm">
                á”áŸ†á–áŸá‰ááŸ‚á•áŸ’á“áŸ‚á€áŠáŸ‚á›á¢áŸ’á“á€á…á„áŸ‹á€áŸ‚á”áŸ’ášáŸ‚á”áŸ‰á»ááŸ’ááŸ„áŸ‡áŸ”
                á•áŸ’á“áŸ‚á€áŠá‘áŸƒá“á¹á„ášá€áŸ’áŸá¶á‘á»á€áá˜áŸ’á›áŸƒáŠá¾á˜áŸ”
              </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Place Name -->
              <div class="flex flex-col">
                <label for="placeName" class="font-semibold text-gray-700 mb-2"
                  >áˆáŸ’á˜áŸ„áŸ‡á‘á¸á€á“áŸ’á›áŸ‚á„ *</label
                >
                <input
                  type="text"
                  id="placeName"
                  name="placeName"
                  required
                  class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
                  placeholder="á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡á‘á¸á€á“áŸ’á›áŸ‚á„"
                />
              </div>

              <!-- Category -->
              <div class="flex flex-col">
                <label for="categoryId" class="font-semibold text-gray-700 mb-2"
                  >á”áŸ’ášá—áŸá‘ *</label
                >
                <select
                  id="categoryId"
                  name="categoryId"
                  required
                  class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
                >
                  <option value="">á‡áŸ’ášá¾áŸášá¾áŸá”áŸ’ášá—áŸá‘</option>
                </select>
              </div>

              <!-- Entry Fee -->
              <div class="flex flex-col">
                <label for="entryFee" class="font-semibold text-gray-700 mb-2"
                  >áá˜áŸ’á›áŸƒáŸáŸ†á”á»ááŸ’ášá…á¼á› (USD)</label
                >
                <input
                  type="number"
                  id="entryFee"
                  name="entryFee"
                  min="0"
                  step="0.01"
                  class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
                  placeholder="0.00"
                />
              </div>

              <!-- Location -->
              <div class="flex flex-col">
                <label for="location" class="font-semibold text-gray-700 mb-2"
                  >á‘á¸áá¶áŸ†á„</label
                >
                <input
                  type="text"
                  id="location"
                  name="location"
                  class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
                  placeholder="ááŸááŸ’á, áŸáŸ’ášá»á€, áƒá»áŸ†"
                />
              </div>
            </div>

            <!-- Description -->
            <div class="flex flex-col">
              <label for="description" class="font-semibold text-gray-700 mb-2"
                >á–á·á–ááŸŒá“á¶</label
              >
              <textarea
                id="description"
                name="description"
                placeholder="á–á·á–ááŸŒá“á¶á›á˜áŸ’á¢á·áá¢áŸ†á–á¸á‘á¸á€á“áŸ’á›áŸ‚á„á“áŸáŸ‡..."
                class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md resize-vertical min-h-[120px]"
              ></textarea>
            </div>

            <!-- Open Hours -->
            <div class="flex flex-col">
              <label for="openHours" class="font-semibold text-gray-700 mb-2"
                >á˜áŸ‰áŸ„á„á”á¾á€</label
              >
              <input
                type="text"
                id="openHours"
                name="openHours"
                class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
                placeholder="á§. 8:00 AM - 5:00 PM"
              />
            </div>

            <!-- Coordinates -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="flex flex-col">
                <label for="latitude" class="font-semibold text-gray-700 mb-2"
                  >Latitude</label
                >
                <input
                  type="number"
                  id="latitude"
                  name="latitude"
                  step="any"
                  class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
                  placeholder="11.5564"
                />
              </div>

              <div class="flex flex-col">
                <label for="longitude" class="font-semibold text-gray-700 mb-2"
                  >Longitude</label
                >
                <input
                  type="number"
                  id="longitude"
                  name="longitude"
                  step="any"
                  class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition"
                  placeholder="104.9282"
                />
              </div>
            </div>

            <!-- Current Images Display -->
            <div id="currentImages" class="hidden">
              <h3 class="font-semibold text-gray-700 mb-3">
                ášá¼á”á—á¶á–á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“
              </h3>
              <div
                id="imagesList"
                class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"
              >
                <!-- Current images will be displayed here -->
              </div>
            </div>

            <!-- New Images Upload -->
            <div class="flex flex-col">
              <label for="images" class="font-semibold text-gray-700 mb-2"
                >ášá¼á”á—á¶á–ááŸ’á˜á¸ (á‡áŸ’ášá¾áŸášá¾áŸá…áŸ’ášá¾á“ášá¼á”á”á¶á“)</label
              >
              <input
                type="file"
                id="images"
                name="images"
                multiple
                accept="image/*"
                class="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-primary focus:shadow-md transition file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/90"
              />
              <p class="text-sm text-gray-500 mt-2">
                á‡áŸ’ášá¾áŸášá¾áŸášá¼á”á—á¶á–ááŸ’á˜á¸áŠá¾á˜áŸ’á”á¸á‡áŸ†á“á½áŸášá¼á”á—á¶á–á…á¶áŸáŸ‹áŸ”
                á¢á¶á…á‡áŸ’ášá¾áŸášá¾áŸá…áŸ’ášá¾á“ášá¼á”á—á¶á–á€áŸ’á“á»á„á–áŸá›ááŸ‚á˜á½á™áŸ”
              </p>
            </div>

            <!-- Image Preview -->
            <div id="imagePreview" class="hidden">
              <h3 class="font-semibold text-gray-700 mb-3">
                á˜á¾á›ášá¼á”á—á¶á–ááŸ’á˜á¸á‡á¶á˜á»á“
              </h3>
              <div
                id="previewList"
                class="grid grid-cols-2 md:grid-cols-4 gap-4"
              >
                <!-- New image previews will be displayed here -->
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col md:flex-row gap-4 pt-6">
              <button
                type="button"
                id="cancelBtn"
                class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-4 rounded-xl transition-all"
              >
                á”áŸ„áŸ‡á”á„áŸ‹
              </button>
              <button
                type="submit"
                id="updateBtn"
                class="flex-1 bg-[#0a4536] text-white font-semibold py-4 rounded-xl hover:shadow-lg transition-all"
              >
                ášá€áŸ’áŸá¶á‘á»á€á€á¶ášá€áŸ‚á”áŸ’ášáŸ‚
              </button>
            </div>
          </form>

          <!-- Status -->
          <div id="status" class="mt-5 p-4 rounded-lg hidden"></div>
        </div>
      </section>
    </main>

    <footer class="bg-white mt-10 py-10">
      <div
        class="container mx-auto px-4 grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 text-left text-sm sm:text-base"
      >
        <div class="flex justify-center md:justify-start gap-4">
          <img
            src="../img/footer.PNG"
            alt="Logo 1"
            class="w-32 h-32 object-contain"
          />
          <img
            src="https://www.cstad.edu.kh/icon.png?ff407d7ec1c2072a"
            alt="Logo 2"
            class="w-27 h-27 object-contain mt-3"
          />
        </div>

        <div
          class="flex flex-col max-lg:mt-3 items-center md:items-start gap-5"
        >
          <h4 class="text-primary font-semibold text-lg">á”ááŸ’áá¶á‰áŸá„áŸ’á‚á˜</h4>
          <div class="flex gap-4 text-primary">
            <!-- Facebook -->
            <a href="">
              <button
                class="group relative inline-flex h-14 w-14 items-center justify-center rounded-full border border-neutral-200 bg-white transition-all duration-300 ease-in-out [box-shadow:0px_4px_1px_#a3a3a3] active:translate-y-[2px] active:shadow-none"
              >
                <i class="fa-brands fa-facebook-f text-3xl text-primary"></i>
              </button>
            </a>

            <!-- TikTok -->
            <a href="">
              <button
                class="group relative inline-flex h-14 w-14 items-center justify-center rounded-full border border-neutral-200 bg-white transition-all duration-300 ease-in-out [box-shadow:0px_4px_1px_#a3a3a3] active:translate-y-[2px] active:shadow-none"
              >
                <i class="fa-brands fa-tiktok text-3xl text-primary"></i>
              </button>
            </a>

            <!-- YouTube -->
            <a href="">
              <button
                class="group relative inline-flex h-14 w-14 items-center justify-center rounded-full border border-neutral-200 bg-white transition-all duration-300 ease-in-out [box-shadow:0px_4px_1px_#a3a3a3] active:translate-y-[2px] active:shadow-none"
              >
                <i class="fa-brands fa-youtube text-3xl text-primary"></i>
              </button>
            </a>
          </div>
        </div>

        <div class="flex flex-col gap-5 items-center md:items-start">
          <h4 class="text-primary font-semibold text-lg">ááŸ†áá—áŸ’á‡á¶á”áŸ‹ášá áŸáŸ</h4>
          <a href="index.html" class="hover:text-green-600 transition"
            >á‘áŸ†á–áŸášáŠá¾á˜</a
          >
          <a href="/html/about.html" class="hover:text-green-600 transition"
            >á¢áŸ†á–á¸á–á½á€á™á¾á„</a
          >
          <a
            href="/html/destination.html"
            class="hover:text-green-600 transition"
            >á‚áŸ„á›áŠáŸ…</a
          >
        </div>

        <div class="flex flex-col gap-5 items-center md:items-start">
          <h4 class="text-primary font-semibold text-lg max-sm:text-center">
            á§á”ááŸ’áá˜áŸ’á—áŠáŸ„á™
          </h4>
          <p>
            Institute of Science and Technology Advanced Development (ISTAD)
          </p>
        </div>
      </div>
    </footer>

    <style>
      .place-item {
        transition: all 0.2s ease;
      }
      .place-item:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      .place-item.selected {
        border-color: #0a4536;
        background-color: #f0fdf4;
      }
      .loading-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #0a4536;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: inline-block;
        margin-right: 8px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .image-preview {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        aspect-ratio: 1;
      }
      .image-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .remove-image-btn {
        position: absolute;
        top: 4px;
        right: 4px;
        background: rgba(220, 38, 38, 0.9);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    </style>

    <script>
      const API_BASE = "https://tos-der.sokpheng.com/api/v1";
      let allPlaces = [];
      let selectedPlace = null;
      let categories = [];

      const searchInput = document.getElementById("searchInput");
      const placesList = document.getElementById("placesList");
      const loadPlacesBtn = document.getElementById("loadPlacesBtn");
      const updateForm = document.getElementById("updateForm");
      const statusDiv = document.getElementById("status");
      const cancelBtn = document.getElementById("cancelBtn");
      const imagesInput = document.getElementById("images");
      const imagePreview = document.getElementById("imagePreview");
      const previewList = document.getElementById("previewList");

      let selectedImages = [];

      // Load categories and places on page load
      window.addEventListener("load", async function () {
        await loadCategories();
        await loadPlaces();
      });

      // Image upload functionality
      imagesInput.addEventListener("change", function (e) {
        selectedImages = Array.from(e.target.files);
        displayImagePreviews();
      });

      function displayImagePreviews() {
        if (selectedImages.length === 0) {
          imagePreview.classList.add("hidden");
          return;
        }

        imagePreview.classList.remove("hidden");
        previewList.innerHTML = "";

        selectedImages.forEach((file, index) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            const imageDiv = document.createElement("div");
            imageDiv.className = "image-preview";
            imageDiv.innerHTML = `
              <img src="${e.target.result}" alt="Preview ${index + 1}" />
              <button type="button" class="remove-image-btn" onclick="removeImage(${index})">Ã—</button>
            `;
            previewList.appendChild(imageDiv);
          };
          reader.readAsDataURL(file);
        });
      }

      function removeImage(index) {
        selectedImages.splice(index, 1);
        displayImagePreviews();

        // Update the file input
        const dt = new DataTransfer();
        selectedImages.forEach((file) => dt.items.add(file));
        imagesInput.files = dt.files;
      }

      // Make removeImage function global for onclick handler
      window.removeImage = removeImage;

      // Load categories
      async function loadCategories() {
        try {
          const response = await fetch(`${API_BASE}/categories`);
          if (!response.ok) throw new Error("Failed to load categories");

          const result = await response.json();
          categories = result.data || result.categories || result || [];

          const categorySelect = document.getElementById("categoryId");
          categorySelect.innerHTML = '<option value="">á‡áŸ’ášá¾áŸášá¾áŸá”áŸ’ášá—áŸá‘</option>';

          categories.forEach((category) => {
            categorySelect.innerHTML += `<option value="${category.id}">${category.name}</option>`;
          });
        } catch (error) {
          console.error("Error loading categories:", error);
          showStatus("âŒ Failed to load categories", "error");
        }
      }

      // Load all places
      loadPlacesBtn.addEventListener("click", async function () {
        await loadPlaces();
      });

      async function loadPlaces() {
        loadPlacesBtn.disabled = true;
        loadPlacesBtn.innerHTML =
          '<div class="loading-spinner"></div>Loading places...';

        try {
          const response = await fetch(`${API_BASE}/places`);
          if (!response.ok) {
            throw new Error(
              `Failed to load places: ${response.status} ${response.statusText}`
            );
          }

          const result = await response.json();
          allPlaces = result.data || result.places || result || [];

          displayPlaces(allPlaces);
          placesList.classList.remove("hidden");
          loadPlacesBtn.innerHTML = "ğŸ”„ á•áŸ’á‘á»á€á€á“áŸ’á›áŸ‚á„á¡á¾á„áœá·á‰";

          showStatus(`âœ… Loaded ${allPlaces.length} places`, "success");
        } catch (error) {
          console.error("Error loading places:", error);
          showStatus(`âŒ Error loading places: ${error.message}`, "error");
        } finally {
          loadPlacesBtn.disabled = false;
        }
      }

      // Search functionality
      searchInput.addEventListener("input", function (e) {
        const query = e.target.value.toLowerCase();
        filterPlaces(query);
      });

      function displayPlaces(places) {
        placesList.innerHTML = "";

        if (places.length === 0) {
          placesList.innerHTML =
            '<p class="text-gray-500 text-center py-4">No places found</p>';
          return;
        }

        places.forEach((place) => {
          const placeElement = document.createElement("div");
          placeElement.className =
            "place-item p-4 border-2 border-gray-200 rounded-xl cursor-pointer";
          placeElement.innerHTML = `
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h3 class="font-semibold text-gray-800">${
                  place.name || "Unnamed Place"
                }</h3>
                <p class="text-sm text-gray-600 mt-1">${(
                  place.description || ""
                ).substring(0, 100)}${
            (place.description || "").length > 100 ? "..." : ""
          }</p>
                <div class="flex items-center space-x-4 mt-2">
                  <span class="text-xs bg-primary/10 text-primary px-2 py-1 rounded">${
                    place.categoryName || "No Category"
                  }</span>
                  <span class="text-xs text-gray-500">ID: ${
                    place.id || "N/A"
                  }</span>
                </div>
              </div>
              <div class="text-right">
                <span class="text-sm text-gray-500">$${
                  place.entryFee || 0
                }</span>
              </div>
            </div>
          `;

          placeElement.addEventListener("click", () =>
            selectPlace(place, placeElement)
          );
          placesList.appendChild(placeElement);
        });
      }

      function selectPlace(place, element) {
        // Remove previous selection
        document.querySelectorAll(".place-item").forEach((item) => {
          item.classList.remove("selected");
        });

        // Select new place
        element.classList.add("selected");
        selectedPlace = place;

        // Populate form with place data
        populateForm(place);

        // Show update form
        updateForm.classList.remove("hidden");

        showStatus(`Selected: ${place.name}`, "info");
      }

      function populateForm(place) {
        // Fill form fields with current place data
        document.getElementById("placeUuid").value = place.uuid || "";
        document.getElementById("placeName").value = place.name || "";
        document.getElementById("categoryId").value = place.categoryId || "";
        document.getElementById("entryFee").value = place.entryFee || "";
        document.getElementById("location").value = place.location || "";
        document.getElementById("description").value = place.description || "";
        document.getElementById("openHours").value = place.openHours || "";
        document.getElementById("latitude").value = place.latitude || "";
        document.getElementById("longitude").value = place.longitude || "";

        // Display current images if any
        displayCurrentImages(place.imageUrls || []);

        // Reset image selection
        selectedImages = [];
        imagesInput.value = "";
        imagePreview.classList.add("hidden");
      }

      function displayCurrentImages(imageUrls) {
        const currentImagesDiv = document.getElementById("currentImages");
        const imagesListDiv = document.getElementById("imagesList");

        if (imageUrls.length > 0) {
          currentImagesDiv.classList.remove("hidden");
          imagesListDiv.innerHTML = "";

          imageUrls.forEach((imageUrl, index) => {
            const imageDiv = document.createElement("div");
            imageDiv.className = "image-preview";
            imageDiv.innerHTML = `
              <img src="${imageUrl}" alt="Place image ${index + 1}" />
            `;
            imagesListDiv.appendChild(imageDiv);
          });
        } else {
          currentImagesDiv.classList.add("hidden");
        }
      }

      function filterPlaces(query) {
        if (!query) {
          displayPlaces(allPlaces);
          return;
        }

        const filtered = allPlaces.filter(
          (place) =>
            (place.name || "").toLowerCase().includes(query) ||
            (place.description || "").toLowerCase().includes(query) ||
            (place.categoryName || "").toLowerCase().includes(query)
        );

        displayPlaces(filtered);
      }

      // Cancel button
      cancelBtn.addEventListener("click", function () {
        updateForm.classList.add("hidden");
        selectedPlace = null;
        document.querySelectorAll(".place-item").forEach((item) => {
          item.classList.remove("selected");
        });
        showStatus("", "");
      });

      // Update form submission
      updateForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        if (!selectedPlace) {
          showStatus("âŒ Please select a place to update", "error");
          return;
        }

        const updateBtn = document.getElementById("updateBtn");
        updateBtn.disabled = true;
        showStatus(
          '<div class="loading-spinner"></div>Updating place...',
          "loading"
        );

        try {
          // Always use JSON approach since your API expects raw JSON with PATCH
          const response = await updateWithJSON();

          if (!response.ok) {
            let errorMessage = `Update failed: ${response.status} ${response.statusText}`;

            try {
              const errorData = await response.json();
              if (errorData.message) {
                errorMessage = errorData.message;
              } else if (errorData.error) {
                errorMessage = errorData.error;
              }
            } catch (e) {
              // Use default error message
            }

            throw new Error(errorMessage);
          }

          const result = await response.json();
          console.log("Update result:", result);

          // Handle image upload separately if images are selected
          if (selectedImages.length > 0) {
            try {
              await uploadImages();
              showStatus(
                `âœ… Place "${selectedPlace.name}" and images updated successfully!`,
                "success"
              );
            } catch (imageError) {
              console.error("Image upload failed:", imageError);
              showStatus(
                `âœ… Place updated successfully, but image upload failed: ${imageError.message}`,
                "warning"
              );
            }
          } else {
            showStatus(
              `âœ… Place "${selectedPlace.name}" updated successfully!`,
              "success"
            );
          }

          // Reset form and reload places
          updateForm.classList.add("hidden");
          selectedPlace = null;
          selectedImages = [];
          imagesInput.value = "";
          imagePreview.classList.add("hidden");
          await loadPlaces();
        } catch (error) {
          console.error("Update error:", error);
          showStatus(`âŒ ${error.message}`, "error");
        } finally {
          updateBtn.disabled = false;
        }
      });

      // Update with JSON (matching your API structure)
      async function updateWithJSON() {
        const updateData = {};

        // Map form fields to API fields
        const fieldMapping = {
          placeName: "name",
          categoryId: "categoryId",
          entryFee: "entryFee",
          location: "location",
          description: "description",
          openHours: "openHours",
          latitude: "latitude",
          longitude: "longitude",
        };

        Object.keys(fieldMapping).forEach((formField) => {
          const element = document.getElementById(formField);
          const value = element.value;
          const apiField = fieldMapping[formField];

          if (value && value.trim() !== "") {
            if (
              formField === "entryFee" ||
              formField === "latitude" ||
              formField === "longitude"
            ) {
              updateData[apiField] = parseFloat(value);
            } else if (formField === "categoryId") {
              updateData[apiField] = parseInt(value);
            } else {
              updateData[apiField] = value;
            }
          }
        });

        console.log("Updating place with JSON:", updateData);

        // Use PATCH method with JSON content type (as shown in your API docs)
        const response = await fetch(
          `${API_BASE}/places/${selectedPlace.uuid}`,
          {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updateData),
          }
        );

        return response;
      }

      // Separate image upload function
      async function uploadImages() {
        if (selectedImages.length === 0) return;

        console.log("Uploading images separately...");

        const imageFormData = new FormData();
        selectedImages.forEach((file) => {
          imageFormData.append("images", file);
        });

        // Try different image upload endpoints
        const imageEndpoints = [
          `${API_BASE}/places/${selectedPlace.uuid}/images`,
          `${API_BASE}/places/${selectedPlace.uuid}/upload-images`,
          `${API_BASE}/upload/places/${selectedPlace.uuid}`,
          `${API_BASE}/places/images/${selectedPlace.uuid}`,
          `${API_BASE}/upload-files/places/${selectedPlace.uuid}`,
        ];

        let lastError;
        for (const endpoint of imageEndpoints) {
          try {
            console.log(`Trying image upload to: ${endpoint}`);
            const imageResponse = await fetch(endpoint, {
              method: "POST",
              body: imageFormData,
            });

            if (imageResponse.ok) {
              console.log("Image upload successful");
              return;
            } else {
              lastError = `${imageResponse.status} ${imageResponse.statusText}`;
            }
          } catch (error) {
            console.log(`Failed to upload to ${endpoint}:`, error);
            lastError = error.message;
          }
        }

        throw new Error(lastError || "All image upload endpoints failed");
      }

      function showStatus(message, type) {
        statusDiv.innerHTML = message;
        statusDiv.className = `mt-5 p-4 rounded-lg`;

        switch (type) {
          case "success":
            statusDiv.classList.add(
              "bg-green-100",
              "text-green-800",
              "border",
              "border-green-300"
            );
            break;
          case "error":
            statusDiv.classList.add(
              "bg-red-100",
              "text-red-800",
              "border",
              "border-red-300"
            );
            break;
          case "loading":
            statusDiv.classList.add(
              "bg-blue-100",
              "text-blue-800",
              "border",
              "border-blue-300"
            );
            break;
          case "warning":
            statusDiv.classList.add(
              "bg-yellow-100",
              "text-yellow-800",
              "border",
              "border-yellow-300"
            );
            break;
          case "info":
            statusDiv.classList.add(
              "bg-gray-100",
              "text-gray-800",
              "border",
              "border-gray-300"
            );
            break;
        }

        statusDiv.style.display = message ? "block" : "none";

        // Auto-hide success messages after 5 seconds
        if (type === "success") {
          setTimeout(() => {
            statusDiv.style.display = "none";
          }, 5000);
        }
      }
    </script>

    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script src="../js/script.js"></script>
    <script src="../js/theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
  </body>
</html>
